<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Auction House | Baldwin County</title>
    <style>
        /* --- LOBBY STYLES --- */
        :root { --primary-color: #2563eb; --header-bg: #111827; --header-text: #f9fafb; --bg-color: #f3f4f6; --text-color: #1f2937; --live-color: #dc2626; --sold-color: #b91c1c; --info-color: #0891b2; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        header { width: 100%; background-color: var(--header-bg); color: var(--header-text); padding: 40px 20px; text-align: center; }
        .brand-name { font-family: "Georgia", "Times New Roman", serif; font-size: 2.5rem; letter-spacing: 2px; font-weight: bold; text-transform: uppercase; margin-bottom: 10px; }
        .tagline { font-size: 1.1rem; color: #9ca3af; font-style: italic; }

        .info-card { background: white; padding: 30px; margin-top: -30px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; max-width: 600px; width: 90%; border-bottom: 4px solid var(--primary-color); }
        .schedule-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: #6b7280; font-weight: bold; }
        .schedule-time { font-size: 1.8rem; font-weight: 800; margin: 10px 0; }
        
        .announcement-text { font-size: 1rem; color: #dc2626; margin-bottom: 15px; white-space: pre-wrap; line-height: 1.5; }
        .announcement-text strong { font-weight: 900; text-decoration: underline; }

        .enter-btn { cursor: pointer; display: inline-block; background-color: var(--primary-color); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 1.1rem; margin-top: 20px; transition: transform 0.2s, background 0.2s; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3); text-decoration: none; }
        .enter-btn:hover { background-color: #1d4ed8; transform: translateY(-2px); }

        .how-btn { display: block; margin: 15px auto 0; background: transparent; border: none; color: var(--info-color); font-weight: bold; cursor: pointer; text-decoration: underline; }
        .how-btn:hover { color: #0e7490; }

        .catalog-section { max-width: 1000px; width: 90%; margin: 50px 0; }
        .section-header { display: flex; justify-content: center; align-items: center; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 30px; }
        .section-title { font-family: "Georgia", serif; font-size: 1.8rem; margin: 0; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 8px; overflow: hidden; border: 1px solid #e5e7eb; transition: transform 0.2s; display: flex; flex-direction: column; position: relative; cursor: pointer; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .card img { width: 100%; height: 200px; object-fit: cover; }
        .card-body { padding: 15px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-weight: bold; margin-bottom: 5px; font-size: 1.1rem; }
        .card-lot { font-size: 0.9rem; color: #6b7280; margin-top: auto; }
        .card-lot strong { color: #374151; }

        .stamp { position: absolute; top: 10px; right: 10px; padding: 5px 12px; font-weight: 900; text-transform: uppercase; border-radius: 4px; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .stamp-live { background-color: var(--live-color); color: white; animation: pulse 1.5s infinite; border: 2px solid white; }
        .stamp-sold { background-color: rgba(255, 255, 255, 0.9); color: var(--sold-color); border: 3px solid var(--sold-color); transform: rotate(-15deg); top: 40px; right: 20px; font-size: 1.2rem; padding: 5px 20px; border-radius: 8px; letter-spacing: 2px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* INFO LIST */
        .info-list { text-align: left; line-height: 1.6; color: #4b5563; margin-bottom: 20px; padding-left: 20px; list-style: disc; }
        .info-list li { margin-bottom: 12px; }
        .info-list strong { color: #1f2937; }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px rgba(0,0,0,0.2); position: relative; }
        .action-btn { width: 100%; padding: 12px; background: var(--header-bg); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1rem; }

        @media (max-width: 600px) { .section-header { flex-direction: column; gap: 15px; text-align: center; } }
    </style>
</head>
<body>

    <header>
        <div class="brand-name">The Auction House</div>
        <div class="tagline">Baldwin County, Alabama</div>
    </header>

    <div class="info-card">
        <div class="schedule-title">Next Live Auction Begins</div>
        <div class="schedule-time" id="scheduleDisplay">Loading schedule...</div>
        
        <div id="announcementDisplay" class="announcement-text"></div>

        <p>Log in or Create an Account to bid.</p>
        <a href="welcome.html" class="enter-btn">Enter Auction Room</a>
        
        <button onclick="openInfoModal()" class="how-btn">ℹ️ How This Auction Works</button>
    </div>

    <div class="catalog-section">
        <div class="section-header">
            <h2 class="section-title">Upcoming Lots</h2>
        </div>
        <div class="grid" id="upcomingGrid">
            <div style="grid-column: 1/-1; text-align:center; color:#999; padding:40px;">Loading upcoming lots...</div>
        </div>
    </div>

    <div id="infoModal" class="modal-overlay" onclick="if(event.target===this) this.style.display='none'">
        <div class="modal-content">
            <h2 style="color: var(--primary-color); margin-top:0;">How It Works & Rules</h2>
            <ul class="info-list">
                <li><strong>One Item at a Time:</strong> The auction is open at a set time, one auction lot is up for bid at a time.</li>
                <li><strong>3-Minute Timer:</strong> The auction lasts for 3 minutes. Bids placed with less than 30 seconds will reset the timer to 30 seconds.</li>
                <li><strong>Binding Bids:</strong> Winning bids is a contract between the seller and the buyer. The Auction House is only a platform service to connect buyers and sellers. The Auction House is not responsible for the quality of the item(s) sold and has no responsibility in the payment made for the sell. These transactions are between the buyer and the seller.</li>
                <li><strong>Baldwin County Only:</strong> The Auction House is for buyers and sellers located in Baldwin County Alabama. The auctions are designed for local pickup or delivery without shipping costs.</li>
            </ul>
            <button class="action-btn" onclick="document.getElementById('infoModal').style.display='none'">Got it!</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- PASTE KEYS HERE ---
      const firebaseConfig = {
  apiKey: "AIzaSyCt0i8a7ZVRlNmSts9yM4uGwV7ghPU59rk",
  authDomain: "eastern-shore-auction.firebaseapp.com",
  databaseURL: "https://eastern-shore-auction-default-rtdb.firebaseio.com",
  projectId: "eastern-shore-auction",
  storageBucket: "eastern-shore-auction.firebasestorage.app",
  messagingSenderId: "771348898846",
  appId: "1:771348898846:web:3b6371e8f826747fdcba0f"
};

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.openInfoModal = function() { document.getElementById('infoModal').style.display = 'flex'; }

        // 1. Load Schedule
        onValue(ref(db, 'settings'), (snapshot) => {
            const data = snapshot.val() || {};
            document.getElementById('scheduleDisplay').innerText = data.schedule || "Schedule TBA";
            let text = data.announcement || "";
            if (text) text = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            document.getElementById('announcementDisplay').innerHTML = text;
        });

        // 2. Load Items
        let activeAuctionKey = null;
        let inventoryData = null;
        let activeEndTime = 0;

        onValue(ref(db, 'active_auction'), (snapshot) => {
            const data = snapshot.val();
            activeAuctionKey = data ? data.inventory_key : null;
            if(data) activeEndTime = data.end_time;
            renderGrid(); 
        });

        onValue(ref(db, 'inventory'), (snapshot) => {
            inventoryData = snapshot.val();
            renderGrid();
        });

        setInterval(renderGrid, 1000);

        function renderGrid() {
            const grid = document.getElementById('upcomingGrid');
            if (!inventoryData) { grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#999;">Loading...</div>'; return; }
            const items = Object.entries(inventoryData).map(([key, val]) => ({ ...val, key }));
            const featuredItems = items.filter(item => item.is_featured === true);
            featuredItems.sort((a, b) => a.lot - b.lot);

            if (featuredItems.length === 0) { grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#999;">Stay tuned! New lots coming soon.</div>'; return; }
            
            grid.innerHTML = ""; 
            const now = Date.now();

            featuredItems.forEach(item => {
                let stampHTML = "";
                if (item.key === activeAuctionKey && activeEndTime > now) {
                    stampHTML = '<div class="stamp stamp-live">LIVE NOW</div>';
                } else if (item.status_label && item.status_label.includes("SOLD")) {
                    stampHTML = '<div class="stamp stamp-sold">SOLD</div>';
                }
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `${stampHTML}<img src="${item.image_url}" alt="${item.title}"><div class="card-body"><div class="card-title">${item.title}</div><div class="card-lot"><strong>Lot #${item.lot}</strong></div></div>`;
                grid.appendChild(card);
            });
        }
    </script>
</body>
</html>