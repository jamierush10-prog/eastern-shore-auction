<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome | Eastern Shore Auction House</title>
    <style>
        /* --- LOBBY STYLES --- */
        :root { --primary-color: #2563eb; --header-bg: #111827; --header-text: #f9fafb; --bg-color: #f3f4f6; --text-color: #1f2937; --live-color: #dc2626; --sold-color: #b91c1c; --info-color: #0891b2; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        header { width: 100%; background-color: var(--header-bg); color: var(--header-text); padding: 40px 20px; text-align: center; }
        .brand-name { font-family: "Georgia", "Times New Roman", serif; font-size: 2.5rem; letter-spacing: 2px; font-weight: bold; text-transform: uppercase; margin-bottom: 10px; }
        .tagline { font-size: 1.1rem; color: #9ca3af; font-style: italic; }

        .info-card { background: white; padding: 30px; margin-top: -30px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; max-width: 600px; width: 90%; border-bottom: 4px solid var(--primary-color); }
        .schedule-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: #6b7280; font-weight: bold; }
        .schedule-time { font-size: 1.8rem; font-weight: 800; margin: 10px 0; }
        
        .announcement-text { font-size: 1rem; color: #dc2626; margin-bottom: 15px; white-space: pre-wrap; line-height: 1.5; }
        .announcement-text strong { font-weight: 900; text-decoration: underline; }

        .enter-btn { cursor: pointer; display: inline-block; background-color: var(--primary-color); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 1.1rem; margin-top: 20px; transition: transform 0.2s, background 0.2s; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3); text-decoration: none; }
        .enter-btn:hover { background-color: #1d4ed8; transform: translateY(-2px); }

        .how-btn { display: block; margin: 15px auto 0; background: transparent; border: none; color: var(--info-color); font-weight: bold; cursor: pointer; text-decoration: underline; }
        .how-btn:hover { color: #0e7490; }

        .catalog-section { max-width: 1000px; width: 90%; margin: 50px 0; }
        .section-header { display: flex; justify-content: center; align-items: center; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 30px; }
        .section-title { font-family: "Georgia", serif; font-size: 1.8rem; margin: 0; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 8px; overflow: hidden; border: 1px solid #e5e7eb; transition: transform 0.2s; display: flex; flex-direction: column; position: relative; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .card img { width: 100%; height: 200px; object-fit: cover; }
        .card-body { padding: 15px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-weight: bold; margin-bottom: 5px; font-size: 1.1rem; }
        .card-lot { font-size: 0.9rem; color: #6b7280; margin-top: auto; }
        .card-lot strong { color: #374151; }

        .stamp { position: absolute; top: 10px; right: 10px; padding: 5px 12px; font-weight: 900; text-transform: uppercase; border-radius: 4px; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .stamp-live { background-color: var(--live-color); color: white; animation: pulse 1.5s infinite; border: 2px solid white; }
        .stamp-sold { background-color: rgba(255, 255, 255, 0.9); color: var(--sold-color); border: 3px solid var(--sold-color); transform: rotate(-15deg); top: 40px; right: 20px; font-size: 1.2rem; padding: 5px 20px; border-radius: 8px; letter-spacing: 2px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        #authModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px rgba(0,0,0,0.2); position: relative; }
        
        .info-list { text-align: left; line-height: 1.6; color: #4b5563; margin-bottom: 20px; }
        .info-list li { margin-bottom: 10px; list-style: none; position: relative; padding-left: 20px; }
        .info-list li::before { content: "•"; color: var(--primary-color); font-weight: bold; position: absolute; left: 0; }
        .info-list strong { color: #1f2937; }

        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb; }
        .tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; font-weight: bold; color: #6b7280; transition: color 0.2s; }
        .tab.active { color: var(--primary-color); border-bottom: 2px solid var(--primary-color); }
        .form-group { margin-bottom: 15px; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        .action-btn { width: 100%; padding: 12px; background: var(--header-bg); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .error-msg { color: #dc2626; font-size: 0.9rem; margin-bottom: 10px; display: none; text-align: center; background: #fee2e2; padding: 8px; border-radius: 4px; }
        .close-reg { text-align: center; margin-top: 15px; cursor: pointer; color: #6b7280; font-size: 0.9rem; text-decoration: underline; }
        .radio-group { display: flex; gap: 15px; margin-bottom: 15px; }
        .radio-label { font-weight: normal; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        #nonLocalWarning { display: none; background: #fff7ed; border: 1px solid #fed7aa; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 0.85rem; color: #9a3412; }
        .close-modal-btn { position: absolute; top: 15px; right: 20px; font-size: 1.8rem; line-height: 1; cursor: pointer; color: #9ca3af; }

        @media (max-width: 600px) { .section-header { flex-direction: column; gap: 15px; text-align: center; } }
    </style>
</head>
<body>

    <header>
        <div class="brand-name">Eastern Shore Auction House</div>
        <div class="tagline">Daphne, Spanish Fort, Fairhope area local Auction</div>
    </header>

    <div class="info-card">
        <div class="schedule-title">Next Live Auction Begins</div>
        <div class="schedule-time" id="scheduleDisplay">Loading schedule...</div>
        
        <div id="announcementDisplay" class="announcement-text"></div>

        <p>Log in or Create an Account to bid.</p>
        <button onclick="openAuthModal()" class="enter-btn">Enter Auction Room</button>
        <button onclick="openInfoModal()" class="how-btn">ℹ️ How This Auction Works</button>
    </div>

    <div class="catalog-section">
        <div class="section-header">
            <h2 class="section-title">Upcoming Lots</h2>
        </div>
        <div class="grid" id="upcomingGrid">
            <div style="grid-column: 1/-1; text-align:center; color:#999; padding:40px;">Loading upcoming lots...</div>
        </div>
    </div>

    <div id="infoModal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color: var(--primary-color); margin-top:0;">How It Works & Rules</h2>
            <ul class="info-list">
                <li><strong>One Item at a Time:</strong> Unlike silent auctions, we sell one item live on the "block". You must be in the Auction Room to bid.</li>
                <li><strong>Soft Close Timer:</strong> If a bid is placed in the last 30 seconds, the timer resets to 30 seconds to prevent sniping.</li>
                <li><strong>Local Pickup:</strong> We are a local community. Buyers must arrange pickup with the seller in the Daphne/Fairhope area.</li>
                </ul>
            <button class="action-btn" onclick="document.getElementById('infoModal').style.display='none'">Got it!</button>
        </div>
    </div>

    <div id="authModal" class="modal-overlay">
        <div class="modal-content">
            <div class="tabs"><div class="tab active" onclick="switchTab('login')">Log In</div><div class="tab" onclick="switchTab('register')">Sign Up</div></div>
            <div id="errorMsg" class="error-msg"></div>
            <form id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
                <div class="form-group"><input type="email" id="loginEmail" placeholder="Email Address" required></div>
                <div class="form-group"><input type="password" id="loginPass" placeholder="Password" required></div>
                <button type="submit" class="action-btn">Log In</button>
            </form>
            <form id="registerForm" style="display:none;" onsubmit="event.preventDefault(); handleRegister();">
                <div class="form-group"><input type="text" id="regName" placeholder="Create Username (Visible to others)" required></div>
                <div class="form-group"><input type="email" id="regEmail" placeholder="Email Address" required></div>
                <div class="form-group"><input type="password" id="regPass" placeholder="Create Password (6+ chars)" required></div>
                <div class="form-group">
                    <label>Are you local to Daphne/Fairhope/Spanish Fort?</label>
                    <div class="radio-group">
                        <label class="radio-label"><input type="radio" name="isLocal" value="yes" checked onchange="toggleLocalFields(true)"> Yes</label>
                        <label class="radio-label"><input type="radio" name="isLocal" value="no" onchange="toggleLocalFields(false)"> No</label>
                    </div>
                </div>
                <div id="nonLocalWarning">
                    <strong>Note:</strong> This site is geared for local buy/sell. <br>
                    Account will require Admin approval before bidding.
                    <div class="form-group" style="margin-top:10px;">
                        <input type="text" id="pickupPlan" placeholder="Can you pick up or deliver locally?">
                    </div>
                </div>
                <button type="submit" class="action-btn">Create Account</button>
            </form>
            <div class="close-reg" onclick="document.getElementById('authModal').style.display='none'">Cancel</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- PASTE KEYS HERE ---
        const firebaseConfig = {
  apiKey: "AIzaSyCt0i8a7ZVRlNmSts9yM4uGwV7ghPU59rk",
  authDomain: "eastern-shore-auction.firebaseapp.com",
  databaseURL: "https://eastern-shore-auction-default-rtdb.firebaseio.com",
  projectId: "eastern-shore-auction",
  storageBucket: "eastern-shore-auction.firebasestorage.app",
  messagingSenderId: "771348898846",
  appId: "1:771348898846:web:3b6371e8f826747fdcba0f"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // --- UI LOGIC ---
        window.openInfoModal = function() { document.getElementById('infoModal').style.display = 'flex'; }

        // --- 1. LOAD SCHEDULE ---
        onValue(ref(db, 'settings'), (snapshot) => {
            const data = snapshot.val() || {};
            document.getElementById('scheduleDisplay').innerText = data.schedule || "Schedule TBA";
            let text = data.announcement || "";
            if (text) {
                text = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            }
            document.getElementById('announcementDisplay').innerHTML = text;
        });

        // --- 2. LOAD FEATURED ITEMS ---
        let activeAuctionData = null;
        let inventoryData = null;

        onValue(ref(db, 'active_auction'), (snapshot) => { activeAuctionData = snapshot.val(); renderGrid(); });
        onValue(ref(db, 'inventory'), (snapshot) => { inventoryData = snapshot.val(); renderGrid(); });
        setInterval(renderGrid, 1000);

        function renderGrid() {
            const grid = document.getElementById('upcomingGrid');
            if (!inventoryData) { grid.innerHTML = '<div style="grid-column: 1/-1; text-align:center; color:#999;">Loading...</div>'; return; }
            const items = Object.entries(inventoryData).map(([key, val]) => ({ ...val, key }));
            const featuredItems = items.filter(item => item.is_featured === true);
            featuredItems.sort((a, b) => a.lot - b.lot);
            if (featuredItems.length === 0) { grid.innerHTML = '<div style="grid-column: 1/-1; text-align:center; color:#999;">Stay tuned! New lots coming soon.</div>'; return; }
            grid.innerHTML = ""; 
            featuredItems.forEach(item => {
                const subtitleText = item.subtitle ? item.subtitle : "No details";
                let stampHTML = "";
                if (activeAuctionData && item.key === activeAuctionData.inventory_key) {
                    if (Date.now() < activeAuctionData.end_time) { stampHTML = '<div class="stamp stamp-live">LIVE NOW</div>'; }
                } else if (item.status_label && item.status_label.includes("SOLD")) {
                    stampHTML = '<div class="stamp stamp-sold">SOLD</div>';
                }
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `${stampHTML}<img src="${item.image_url}" alt="${item.title}"><div class="card-body"><div class="card-title">${item.title}</div><div class="card-lot"><strong>Lot #${item.lot}</strong> <br> ${subtitleText}</div></div>`;
                grid.appendChild(card);
            });
        }

        // --- AUTH ---
        window.toggleLocalFields = function(isLocal) {
            const div = document.getElementById('nonLocalWarning');
            const input = document.getElementById('pickupPlan');
            if(isLocal) { div.style.display = 'none'; input.removeAttribute('required'); } 
            else { div.style.display = 'block'; input.setAttribute('required', 'true'); }
        }
        window.openAuthModal = function() {
            if(auth.currentUser) { window.location.href = "auction.html"; }
            else { document.getElementById('authModal').style.display = 'flex'; }
        }
        window.switchTab = function(mode) {
            document.getElementById('errorMsg').style.display = 'none';
            if(mode === 'login') {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.querySelectorAll('.tab')[1].classList.remove('active');
            } else {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'block';
                document.querySelectorAll('.tab')[0].classList.remove('active');
                document.querySelectorAll('.tab')[1].classList.add('active');
            }
        }
        window.handleLogin = function() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            const btn = document.querySelector('#loginForm button');
            btn.disabled = true; btn.innerText = "Verifying...";
            signInWithEmailAndPassword(auth, email, pass)
            .then(() => { window.location.href = "auction.html"; })
            .catch((error) => { showError(error.message); btn.