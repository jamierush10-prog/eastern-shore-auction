<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eastern Shore Auction House</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary-color: #2563eb; --header-bg: #111827; }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: #f3f4f6; }
        
        .brand-font { font-family: "Georgia", serif; }
        
        /* Hero Section Background */
        .hero-bg {
            background-color: var(--header-bg);
            color: white;
            padding: 60px 20px 100px; /* Added extra padding bottom for overlap */
            text-align: center;
            position: relative;
        }

        /* The main white card overlapping the hero */
        .main-card {
            background: white;
            max-width: 800px;
            margin: -80px auto 40px; /* Negative top margin creates overlap */
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .enter-btn {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            transition: transform 0.2s, background-color 0.2s;
            display: inline-block;
            text-decoration: none;
            margin-top: 20px;
        }
        .enter-btn:hover { transform: scale(1.05); background-color: #1d4ed8; }

        /* Rules Button & Modal */
        .info-btn {
            background-color: transparent;
            border: 2px solid #d1d5db;
            color: #374151;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .info-btn:hover { border-color: var(--primary-color); color: var(--primary-color); }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; position: relative; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .close-modal-btn { position: absolute; top: 15px; right: 20px; font-size: 1.8rem; line-height: 1; cursor: pointer; color: #9ca3af; }
        .close-modal-btn:hover { color: #374151; }
        .rules-section { margin-bottom: 25px; text-align: left; }
        .rules-section h3 { color: var(--primary-color); margin-bottom: 10px; font-size: 1.2rem; font-weight: bold; display: flex; align-items: center; gap: 8px;}
        .rules-section ul { padding-left: 20px; line-height: 1.6; color: #4b5563; list-style-type: disc; }
        .rules-section li { margin-bottom: 8px; }
    </style>
</head>
<body>

    <div class="hero-bg">
        <h1 class="brand-font text-4xl md:text-5xl font-bold tracking-wide uppercase mb-2">Eastern Shore Auction House</h1>
        <p class="text-gray-400 italic text-lg mb-8">Daphne, Spanish Fort, Fairhope area local Auction</p>
    </div>

    <div class="main-card">
        <h2 class="text-gray-500 font-bold text-sm tracking-widest uppercase mb-2">Next Live Auction Begins</h2>
        <div id="scheduleDisplay" class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-6">
            Loading schedule...
        </div>
        
        <p class="text-gray-600 mb-8 text-lg">
            Log in or Create an Account to bid.
        </p>

        <a href="auction.html" class="enter-btn">Enter Auction Room</a>
    </div>

    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="flex justify-between align-middle items-center border-b border-gray-200 pb-4 mb-8">
            <h2 class="brand-font text-3xl font-bold text-gray-800">Upcoming Lots</h2>
            <button class="info-btn" onclick="openRulesModal()">How It Works & Rules</button>
        </div>

        <div id="featuredGrid" class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="col-span-3 text-center text-gray-500 py-10">Loading upcoming items...</div>
        </div>
    </div>

    <div id="rulesModal" class="modal-overlay" onclick="closeRulesModal(event)">
        <div class="modal-content">
            <span class="close-modal-btn" onclick="closeRulesModal(event)">&times;</span>
            <h2 class="brand-font" style="text-align:center; margin-top:0; margin-bottom: 20px; font-size: 1.8rem; font-weight: bold;">How It Works & Rules</h2>

            <div class="rules-section">
                <h3>‚è∞ The Live Auction Process</h3>
                <ul>
                    <li><strong>One Item at a Time:</strong> Unlike silent auctions, we sell one item live on the "block." You must be in the Live Auction Room to participate.</li>
                    <li><strong>The Going, Going, Gone Timer:</strong> Every new bid resets the countdown timer (usually to 30 seconds). The item is not sold until the timer hits zero without any new bids.</li>
                    <li><strong>Bidding:</strong> You can place quick incremental bids or set a <strong>Max Proxy Bid</strong>. The system will automatically bid for you in small increments up to your maximum amount to keep you in the lead.</li>
                </ul>
            </div>

            <div class="rules-section">
                <h3>üìã Participation Rules</h3>
                <ul>
                    <li><strong>Registration:</strong> You must have a registered account to view the live auction and place bids.</li>
                    <li><strong>Bids are Binding:</strong> Placing a bid is a binding contract to purchase the item if you win.</li>
                    <li><strong>Payment & Pickup:</strong> Winning bidders are expected to arrange payment and local pickup promptly after the auction event concludes.</li>
                </ul>
            </div>

            <div class="rules-section">
                <h3>üì¶ Selling With Us</h3>
                <ul>
                    <li>Registered users can submit items for consideration via their "My Account" page.</li>
                    <li>All submissions are reviewed by our staff. If approved, they will be scheduled for an upcoming live event.</li>
                </ul>
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
  apiKey: "AIzaSyCt0i8a7ZVRlNmSts9yM4uGwV7ghPU59rk",
  authDomain: "eastern-shore-auction.firebaseapp.com",
  databaseURL: "https://eastern-shore-auction-default-rtdb.firebaseio.com",
  projectId: "eastern-shore-auction",
  storageBucket: "eastern-shore-auction.firebasestorage.app",
  messagingSenderId: "771348898846",
  appId: "1:771348898846:web:3b6371e8f826747fdcba0f"
};

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 1. Load Schedule
        const scheduleRef = ref(db, 'auction_schedule');
        onValue(scheduleRef, (snapshot) => {
            const data = snapshot.val();
            document.getElementById('scheduleDisplay').innerText = data || "Schedule TBA";
        });

        // 2. Load Featured Items
        const inventoryRef = ref(db, 'inventory');
        // Query for items where is_featured is true
        const featuredQuery = query(inventoryRef, orderByChild('is_featured'), limitToLast(50));

        onValue(featuredQuery, (snapshot) => {
            const grid = document.getElementById('featuredGrid');
            grid.innerHTML = "";
            const data = snapshot.val();

            if (!data) {
                grid.innerHTML = '<div class="col-span-3 text-center text-gray-500 py-10">No upcoming items scheduled yet.</div>';
                return;
            }

            // Filter client-side because Firebase query can return nulls for false values if not careful
            const featuredItems = Object.values(data).filter(item => item.is_featured === true && item.times_run === 0);

            if (featuredItems.length === 0) {
                grid.innerHTML = '<div class="col-span-3 text-center text-gray-500 py-10">No upcoming items scheduled yet. Check back soon!</div>';
                return;
            }
            
            // Sort by Lot number
            featuredItems.sort((a, b) => a.lot - b.lot);

            featuredItems.forEach(item => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300";
                card.innerHTML = `
                    <div class="h-48 bg-gray-200 relative">
                        <img src="${item.image_url}" alt="${item.title}" class="w-full h-full object-cover">
                        <div class="absolute top-0 right-0 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-bl-lg uppercase tracking-wider">
                            UPCOMING
                        </div>
                    </div>
                    <div class="p-5">
                        <h3 class="font-bold text-xl mb-1 text-gray-800 truncate">${item.title}</h3>
                        <div class="text-sm text-gray-500 mb-3">Lot #${item.lot}</div>
                        <p class="text-gray-600 text-sm line-clamp-2">${item.subtitle || item.description}</p>
                    </div>
                `;
                grid.appendChild(card);
            });
        });

        // --- MODAL LOGIC ---
        window.openRulesModal = function() {
            document.getElementById('rulesModal').style.display = 'flex';
            // Prevent body scrolling when modal is open
            document.body.style.overflow = 'hidden';
        }

        window.closeRulesModal = function(event) {
            // Close if clicking the 'X' or the background overlay
            if (!event || event.target === document.getElementById('rulesModal') || event.target.classList.contains('close-modal-btn')) {
                document.getElementById('rulesModal').style.display = 'none';
                // Re-enable body scrolling
                document.body.style.overflow = 'auto';
            }
        }
    </script>
</body>
</html>