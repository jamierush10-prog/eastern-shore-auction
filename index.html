<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eastern Shore Auction House</title>
    <style>
        :root { --primary-color: #2563eb; --bg-color: #f3f4f6; --text-color: #1f2937; --header-bg: #111827; }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; display: flex; flex-direction: column; min-height: 100vh; }

        /* HEADER */
        .header-strip { background-color: var(--header-bg); color: #9ca3af; padding: 12px 0; text-align: center; font-size: 0.9rem; font-style: italic; letter-spacing: 0.5px; border-bottom: 4px solid var(--primary-color); }
        
        /* HERO SECTION */
        .hero-section { display: flex; justify-content: center; margin-top: 40px; padding: 0 20px; }
        .hero-card { background: white; max-width: 600px; width: 100%; padding: 50px 40px; border-radius: 12px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.08); }
        .hero-label { font-size: 0.8rem; font-weight: bold; color: #6b7280; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 15px; }
        .hero-date { font-size: 2.2rem; font-weight: 800; color: var(--text-color); margin: 0 0 25px 0; line-height: 1.1; letter-spacing: -0.5px; }
        .hero-text { color: #dc2626; line-height: 1.7; font-size: 1rem; margin-bottom: 30px; font-weight: 500; }
        .signature { font-family: "Georgia", serif; font-style: italic; color: #b91c1c; margin-bottom: 35px; display: block; font-size: 1.1rem; }
        
        .cta-button { cursor: pointer; display: inline-block; background-color: var(--primary-color); color: white; padding: 16px 32px; border-radius: 30px; font-weight: bold; font-size: 1.1rem; text-decoration: none; transition: transform 0.2s, background 0.2s; box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3); border: none; }
        .cta-button:hover { background-color: #1d4ed8; transform: translateY(-2px); }
        
        .helper-text { margin-bottom: 20px; font-size: 1rem; color: #1f2937; }
        .helper-link { color: #5b6676; text-decoration: underline; text-decoration-style: dotted; font-size: 0.85rem; cursor: pointer; display: inline-block; margin-top: 25px; font-weight: bold; }

        /* UPCOMING SECTION */
        .upcoming-section { max-width: 1000px; margin: 80px auto; padding: 0 20px; text-align: center; }
        h2.section-title { font-family: "Georgia", serif; font-size: 2.2rem; color: var(--text-color); margin-bottom: 50px; display: inline-block; font-weight: bold; border-bottom: 2px solid #e5e7eb; padding-bottom: 20px; }
        
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 30px; justify-content: center; }
        
        /* ITEM CARD */
        .item-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: transform 0.2s; cursor: pointer; text-decoration: none; color: inherit; display: flex; flex-direction: column; border: 1px solid #f3f4f6; }
        .item-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .card-img { width: 100%; height: 200px; object-fit: cover; background: #eee; }
        .card-body { padding: 20px; text-align: left; }
        .card-lot { font-size: 0.75rem; color: #6b7280; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; letter-spacing: 0.5px; }
        .card-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #111827; }
        .card-price { color: #16a34a; font-weight: bold; font-size: 1.1rem; }
        
        .status-badge { float: right; font-size: 0.7rem; padding: 2px 8px; border-radius: 12px; font-weight: bold; }
        .status-live { background: #fee2e2; color: #dc2626; border: 1px solid #fca5a5; }
        .status-sold { background: #fef3c7; color: #b45309; border: 1px solid #fcd34d; }
        .status-ended { background: #e5e7eb; color: #374151; border: 1px solid #d1d5db; }

        .loading-text { color: #9ca3af; font-style: italic; grid-column: 1/-1; padding: 40px; }
        .footer-text { margin-top: 60px; margin-bottom: 40px; color: #9ca3af; font-size: 0.9rem; text-align: center; }

        /* AUTH MODAL STYLES */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 25px 50px rgba(0,0,0,0.25); position: relative; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb; }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: bold; color: #6b7280; transition: color 0.2s; }
        .tab.active { color: var(--primary-color); border-bottom: 2px solid var(--primary-color); }
        .form-group { margin-bottom: 15px; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .action-btn { width: 100%; padding: 12px; background: var(--header-bg); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: background 0.2s; }
        .action-btn:hover { background: #374151; }
        .error-msg { color: #dc2626; font-size: 0.9rem; margin-bottom: 15px; display: none; text-align: center; background: #fee2e2; padding: 10px; border-radius: 6px; }
        .close-reg { text-align: center; margin-top: 15px; cursor: pointer; color: #6b7280; font-size: 0.9rem; text-decoration: underline; display: block; }
        .radio-group { display: flex; gap: 15px; margin-bottom: 15px; font-size: 0.9rem; }
        .radio-label { font-weight: normal; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        #nonLocalWarning { display: none; background: #fff7ed; border: 1px solid #fed7aa; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 0.85rem; color: #9a3412; }

        @media (max-width: 600px) {
            .hero-date { font-size: 1.8rem; }
            .grid-container { grid-template-columns: 1fr 1fr; gap: 15px; }
            .item-card { border-radius: 8px; }
            .card-img { height: 150px; }
        }
    </style>
</head>
<body>

    <div class="header-strip">Baldwin County, Alabama</div>

    <div class="hero-section">
        <div class="hero-card">
            <div class="hero-label">Live Auction Marketplace</div>
            <div class="hero-date">Open 24/7</div>
            
            <p class="hero-text">
                Welcome to The Auction House! We are now operating as a live marketplace. Sellers can list items for 15 minutes or up to 7 days. Bid live, win instantly!
            </p>
            
            <span class="signature">â€” Jamie Rush</span>

            <div class="helper-text">Log in or Create an Account to bid.</div>
            
            <button onclick="openAuthModal()" class="cta-button">Create Account / Login</button>
            <br>
            <div style="margin-top:15px"><a href="create_listing.html" style="color: #2563eb; font-weight: bold; text-decoration: none;">Have something to sell? List it now &rarr;</a></div>
        </div>
    </div>

    <div class="upcoming-section">
        <h2 class="section-title">Active Auctions</h2>
        <div id="lotsGrid" class="grid-container">
            <div class="loading-text">Loading live auctions...</div>
        </div>
        <div class="footer-text">Check back often for new listings!</div>
    </div>

    <div id="authModal" class="modal-overlay">
        <div class="modal-content">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('login')">Log In</div>
                <div class="tab" onclick="switchTab('register')">Sign Up</div>
            </div>
            <div id="errorMsg" class="error-msg"></div>
            
            <form id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
                <div class="form-group"><input type="email" id="loginEmail" placeholder="Email Address" required></div>
                <div class="form-group"><input type="password" id="loginPass" placeholder="Password" required></div>
                <button type="submit" class="action-btn">Log In</button>
            </form>
            
            <form id="registerForm" style="display:none;" onsubmit="event.preventDefault(); handleRegister();">
                <div class="form-group"><input type="text" id="regName" placeholder="Full Name" required></div>
                <div class="form-group"><input type="email" id="regEmail" placeholder="Email Address" required></div>
                <div class="form-group"><input type="password" id="regPass" placeholder="Password (6+ chars)" required></div>
                
                <div class="form-group">
                    <label style="font-size:0.9rem; font-weight:bold; display:block; margin-bottom:5px;">Located in Baldwin County, AL?</label>
                    <div class="radio-group">
                        <label class="radio-label"><input type="radio" name="isLocal" value="yes" checked onchange="toggleLocalFields(true)"> Yes</label>
                        <label class="radio-label"><input type="radio" name="isLocal" value="no" onchange="toggleLocalFields(false)"> No</label>
                    </div>
                </div>
                
                <div id="nonLocalWarning">
                    <strong>Note:</strong> Non-local accounts require Admin approval.
                    <div class="form-group" style="margin-top:10px;"><input type="text" id="pickupPlan" placeholder="Can you arrange local pickup?"></div>
                </div>
                
                <button type="submit" class="action-btn">Create Account</button>
            </form>
            <span class="close-reg" onclick="document.getElementById('authModal').style.display='none'">Cancel</span>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, onValue, set, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
          apiKey: "AIzaSyCt0i8a7ZVRlNmSts9yM4uGwV7ghPU59rk",
          authDomain: "eastern-shore-auction.firebaseapp.com",
          databaseURL: "https://eastern-shore-auction-default-rtdb.firebaseio.com",
          projectId: "eastern-shore-auction",
          storageBucket: "eastern-shore-auction.firebasestorage.app",
          messagingSenderId: "771348898846",
          appId: "1:771348898846:web:3b6371e8f826747fdcba0f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // --- AUTH LOGIC ---
        window.openAuthModal = function() {
            if (auth.currentUser) {
                // If logged in, maybe scroll to auctions or show a message
                document.querySelector('.upcoming-section').scrollIntoView({behavior: "smooth"});
            } else {
                document.getElementById('authModal').style.display = 'flex';
            }
        }
        
        window.switchTab = function(mode) {
            document.getElementById('errorMsg').style.display = 'none';
            if(mode === 'login') {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.querySelectorAll('.tab')[1].classList.remove('active');
            } else {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'block';
                document.querySelectorAll('.tab')[0].classList.remove('active');
                document.querySelectorAll('.tab')[1].classList.add('active');
            }
        }

        window.toggleLocalFields = function(isLocal) {
            const div = document.getElementById('nonLocalWarning');
            const input = document.getElementById('pickupPlan');
            if(isLocal) { div.style.display = 'none'; input.removeAttribute('required'); } 
            else { div.style.display = 'block'; input.setAttribute('required', 'true'); }
        }

        window.handleLogin = function() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            const btn = document.querySelector('#loginForm button');
            btn.disabled = true; btn.innerText = "Verifying...";
            
            signInWithEmailAndPassword(auth, email, pass)
            .then((userCredential) => { 
                document.getElementById('authModal').style.display = 'none';
                btn.disabled = false; btn.innerText = "Log In";
                alert("Welcome back, " + (userCredential.user.displayName || "User") + "!");
            })
            .catch((error) => { 
                showError(error.message);
                btn.disabled = false; btn.innerText = "Log In"; 
            });
        }

        window.handleRegister = function() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            const isLocal = document.querySelector('input[name="isLocal"]:checked').value === "yes";
            const pickupPlan = document.getElementById('pickupPlan').value;
            const btn = document.querySelector('#registerForm button');

            if(pass.length < 6) { showError("Password must be at least 6 characters"); return; }
            
            btn.disabled = true; btn.innerText = "Creating Account...";
            
            createUserWithEmailAndPassword(auth, email, pass)
            .then((userCredential) => {
                const user = userCredential.user;
                updateProfile(user, { displayName: name }).then(() => {
                    set(ref(db, 'users/' + user.uid), {
                        name: name, email: email, is_local: isLocal, pickup_plan: isLocal ? "Local" : pickupPlan,
                        is_approved: isLocal ? true : false, joined_at: Date.now()
                    }).then(() => { 
                        document.getElementById('authModal').style.display = 'none';
                        alert("Account Created! You can now bid.");
                    });
                });
            })
            .catch((error) => { 
                showError(error.message);
                btn.disabled = false; btn.innerText = "Create Account"; 
            });
        }

        function showError(msg) {
            const errDiv = document.getElementById('errorMsg');
            errDiv.style.display = 'block';
            errDiv.innerText = msg.replace("Firebase: ", "").replace("auth/", "").replace(/-/g, " ");
        }

        // --- LIVE AUCTION FEED ---
        // NEW: Listening to 'auctions' node instead of 'inventory'
        const auctionsRef = ref(db, 'auctions');
        onValue(auctionsRef, (snapshot) => {
            const grid = document.getElementById('lotsGrid');
            grid.innerHTML = ""; 
            
            const data = snapshot.val();
            if (!data) {
                grid.innerHTML = '<div class="loading-text">No active auctions right now.<br><a href="create_listing.html" style="color:var(--primary-color)">Be the first to list something!</a></div>';
                return;
            }

            // Convert to array and sort by END TIME (Ending soonest first)
            const items = Object.entries(data).map(([key, val]) => ({ ...val, id: key }));
            items.sort((a, b) => a.end_time - b.end_time);

            items.forEach(item => {
                const now = Date.now();
                let statusBadge = "";
                
                // Determine Status
                if (item.status === "ended" || now > item.end_time) {
                    statusBadge = `<span class="status-badge status-ended">ENDED</span>`;
                } else {
                    statusBadge = `<span class="status-badge status-live">LIVE NOW</span>`;
                }

                // DYNAMIC LINK: Passes the Auction ID to the next page
                const card = document.createElement('a');
                card.className = 'item-card';
                card.href = `auction.html?id=${item.id}`; 
                
                card.innerHTML = `
                    <img src="${item.image_url}" class="card-img" alt="${item.title}" onerror="this.src='https://placehold.co/400x300?text=No+Image'">
                    <div class="card-body">
                        <div class="card-lot">${statusBadge}</div>
                        <div class="card-title">${item.title}</div>
                        <div class="card-price" style="display:flex; justify-content:space-between; align-items:center;">
                            <span>$${item.current_bid}</span>
                            <span style="font-size:0.8rem; color:#6b7280; font-weight:normal;">${getTimeLeft(item.end_time)} left</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        });

        function getTimeLeft(endTime) {
            const now = Date.now();
            const diff = endTime - now;
            if(diff <= 0) return "0m";
            const mins = Math.floor(diff / 60000);
            if(mins > 60) {
                const hrs = Math.floor(mins / 60);
                return hrs + "h " + (mins % 60) + "m";
            }
            return mins + "m";
        }
    </script>

</body>
</html>