<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eastern Shore Auction House</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary-color: #2563eb; --header-bg: #111827; }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: #f3f4f6; }
        
        .brand-font { font-family: "Georgia", serif; }
        
        /* Hero Section */
        .hero-bg {
            background-color: var(--header-bg);
            color: white;
            padding: 60px 20px 100px;
            text-align: center;
            position: relative;
        }

        /* Main Card */
        .main-card {
            background: white;
            max-width: 800px;
            margin: -80px auto 40px;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .enter-btn {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            transition: transform 0.2s, background-color 0.2s;
            display: inline-block;
            border: none;
            cursor: pointer;
            margin-top: 20px;
        }
        .enter-btn:hover { transform: scale(1.05); background-color: #1d4ed8; }

        /* Rules Button */
        .info-btn {
            background-color: transparent;
            border: 2px solid #d1d5db;
            color: #374151;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .info-btn:hover { border-color: var(--primary-color); color: var(--primary-color); }

        /* Modals */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; position: relative; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .close-modal-btn { position: absolute; top: 15px; right: 20px; font-size: 1.8rem; line-height: 1; cursor: pointer; color: #9ca3af; }
        .close-modal-btn:hover { color: #374151; }
        
        /* Auth Specific Styles */
        .auth-content { max-width: 400px; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb; }
        .tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; font-weight: bold; color: #6b7280; transition: color 0.2s; }
        .tab.active { color: var(--primary-color); border-bottom: 2px solid var(--primary-color); }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        .action-btn { width: 100%; padding: 12px; background: var(--header-bg); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .error-msg { color: #dc2626; font-size: 0.9rem; margin-bottom: 10px; display: none; text-align: center; background: #fee2e2; padding: 8px; border-radius: 4px; }

        /* Rules Specific Styles */
        .rules-section { margin-bottom: 25px; text-align: left; }
        .rules-section h3 { color: var(--primary-color); margin-bottom: 10px; font-size: 1.2rem; font-weight: bold; }
        .rules-section ul { padding-left: 20px; line-height: 1.6; color: #4b5563; list-style-type: disc; }
        .rules-section li { margin-bottom: 8px; }
    </style>
</head>
<body>

    <div class="hero-bg">
        <h1 class="brand-font text-4xl md:text-5xl font-bold tracking-wide uppercase mb-2">Eastern Shore Auction House</h1>
        <p class="text-gray-400 italic text-lg mb-8">Daphne, Spanish Fort, Fairhope area local Auction</p>
    </div>

    <div class="main-card">
        <h2 class="text-gray-500 font-bold text-sm tracking-widest uppercase mb-2">Next Live Auction Begins</h2>
        <div id="scheduleDisplay" class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-6">
            Loading schedule...
        </div>
        
        <p class="text-gray-600 mb-8 text-lg">
            Log in or Create an Account to bid.
        </p>

        <button onclick="openAuthModal()" class="enter-btn">Enter Auction Room</button>
    </div>

    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="flex justify-between align-middle items-center border-b border-gray-200 pb-4 mb-8">
            <h2 class="brand-font text-3xl font-bold text-gray-800">Upcoming Lots</h2>
            <button class="info-btn" onclick="openRulesModal()">How It Works & Rules</button>
        </div>

        <div id="featuredGrid" class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="col-span-3 text-center text-gray-500 py-10">Loading upcoming items...</div>
        </div>
    </div>

    <div id="rulesModal" class="modal-overlay" onclick="closeRulesModal(event)">
        <div class="modal-content">
            <span class="close-modal-btn" onclick="closeRulesModal(event)">&times;</span>
            <h2 class="brand-font" style="text-align:center; margin-top:0; margin-bottom: 20px; font-size: 1.8rem; font-weight: bold;">How It Works & Rules</h2>
            <div class="rules-section">
                <h3>‚è∞ The Live Auction Process</h3>
                <ul>
                    <li><strong>One Item at a Time:</strong> We sell one item live on the "block."</li>
                    <li><strong>The Timer:</strong> Every new bid resets the countdown. Item sells when timer hits zero.</li>
                    <li><strong>Proxy Bidding:</strong> You can set a max bid, and the system will bid for you automatically.</li>
                </ul>
            </div>
            <div class="rules-section">
                <h3>üìã Rules</h3>
                <ul>
                    <li><strong>Binding Bids:</strong> Placing a bid is a contract to buy.</li>
                    <li><strong>Local Pickup:</strong> Winning bidders must arrange local pickup.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="authModal" class="modal-overlay">
        <div class="modal-content auth-content">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('login')">Log In</div>
                <div class="tab" onclick="switchTab('register')">Sign Up</div>
            </div>
            <div id="errorMsg" class="error-msg"></div>
            
            <form id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
                <div class="form-group"><input type="email" id="loginEmail" placeholder="Email Address" required></div>
                <div class="form-group"><input type="password" id="loginPass" placeholder="Password" required></div>
                <button type="submit" class="action-btn">Log In</button>
            </form>

            <form id="registerForm" style="display:none;" onsubmit="event.preventDefault(); handleRegister();">
                <div class="form-group"><input type="text" id="regName" placeholder="Create Username" required></div>
                <div class="form-group"><input type="email" id="regEmail" placeholder="Email Address" required></div>
                <div class="form-group"><input type="password" id="regPass" placeholder="Password (6+ chars)" required></div>
                
                <div class="form-group" style="background: #f9fafb; padding: 10px; border-radius: 6px;">
                    <label style="display:block; font-weight:bold; font-size:0.9rem; margin-bottom:5px;">Are you local to Daphne/Fairhope?</label>
                    <div style="display:flex; gap:15px;">
                        <label><input type="radio" name="isLocal" value="yes" checked onchange="toggleLocalFields(true)"> Yes</label>
                        <label><input type="radio" name="isLocal" value="no" onchange="toggleLocalFields(false)"> No</label>
                    </div>
                </div>

                <div id="nonLocalWarning" style="display:none; font-size:0.85rem; color:#9a3412; background:#fff7ed; padding:10px; border-radius:6px; margin-bottom:10px;">
                    <strong>Note:</strong> Non-local accounts require Admin approval before bidding.
                    <input type="text" id="pickupPlan" placeholder="Can you pick up locally?" style="margin-top:5px;">
                </div>

                <button type="submit" class="action-btn">Create Account</button>
            </form>
            <div class="close-modal-btn" style="top: 10px; right: 15px;" onclick="document.getElementById('authModal').style.display='none'">&times;</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, onValue, query, orderByChild, limitToLast, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- PASTE KEYS HERE ---
        const firebaseConfig = {
  apiKey: "AIzaSyCt0i8a7ZVRlNmSts9yM4uGwV7ghPU59rk",
  authDomain: "eastern-shore-auction.firebaseapp.com",
  databaseURL: "https://eastern-shore-auction-default-rtdb.firebaseio.com",
  projectId: "eastern-shore-auction",
  storageBucket: "eastern-shore-auction.firebasestorage.app",
  messagingSenderId: "771348898846",
  appId: "1:771348898846:web:3b6371e8f826747fdcba0f"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // 1. Load Schedule
        onValue(ref(db, 'auction_schedule'), (snapshot) => {
            const data = snapshot.val();
            document.getElementById('scheduleDisplay').innerText = data || "Schedule TBA";
        });

        // 2. Load Featured Items
        const featuredQuery = query(ref(db, 'inventory'), orderByChild('is_featured'), limitToLast(50));
        onValue(featuredQuery, (snapshot) => {
            const grid = document.getElementById('featuredGrid');
            grid.innerHTML = "";
            const data = snapshot.val();

            if (!data) { grid.innerHTML = '<div class="col-span-3 text-center text-gray-500 py-10">No upcoming items scheduled.</div>'; return; }
            
            const featuredItems = Object.values(data).filter(item => item.is_featured === true && item.times_run === 0);
            featuredItems.sort((a, b) => a.lot - b.lot);

            if (featuredItems.length === 0) { grid.innerHTML = '<div class="col-span-3 text-center text-gray-500 py-10">No upcoming items scheduled.</div>'; return; }

            featuredItems.forEach(item => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300";
                card.innerHTML = `
                    <div class="h-48 bg-gray-200 relative">
                        <img src="${item.image_url}" alt="${item.title}" class="w-full h-full object-cover">
                        <div class="absolute top-0 right-0 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-bl-lg uppercase tracking-wider">UPCOMING</div>
                    </div>
                    <div class="p-5">
                        <h3 class="font-bold text-xl mb-1 text-gray-800 truncate">${item.title}</h3>
                        <div class="text-sm text-gray-500 mb-3">Lot #${item.lot}</div>
                        <p class="text-gray-600 text-sm line-clamp-2">${item.subtitle || item.description}</p>
                    </div>
                `;
                grid.appendChild(card);
            });
        });

        // --- AUTH LOGIC ---
        window.openAuthModal = function() {
            if(auth.currentUser) { window.location.href = "auction.html"; }
            else { document.getElementById('authModal').style.display = 'flex'; }
        }

        window.toggleLocalFields = function(isLocal) {
            const div = document.getElementById('nonLocalWarning');
            const input = document.getElementById('pickupPlan');
            if(isLocal) { div.style.display = 'none'; input.removeAttribute('required'); } 
            else { div.style.display = 'block'; input.setAttribute('required', 'true'); }
        }

        window.switchTab = function(mode) {
            document.getElementById('errorMsg').style.display = 'none';
            if(mode === 'login') {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.querySelectorAll('.tab')[1].classList.remove('active');
            } else {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'block';
                document.querySelectorAll('.tab')[0].classList.remove('active');
                document.querySelectorAll('.tab')[1].classList.add('active');
            }
        }

        window.handleLogin = function() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            const btn = document.querySelector('#loginForm button');
            btn.disabled = true; btn.innerText = "Verifying...";
            signInWithEmailAndPassword(auth, email, pass)
            .then(() => { window.location.href = "auction.html"; })
            .catch((error) => { showError(error.message); btn.disabled = false; btn.innerText = "Log In"; });
        }

        window.handleRegister = function() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            const isLocal = document.querySelector('input[name="isLocal"]:checked').value === "yes";
            const pickupPlan = document.getElementById('pickupPlan').value;
            const btn = document.querySelector('#registerForm button');

            if(pass.length < 6) { showError("Password must be at least 6 characters"); return; }
            btn.disabled = true; btn.innerText = "Creating Account...";

            createUserWithEmailAndPassword(auth, email, pass)
            .then((userCredential) => {
                const user = userCredential.user;
                updateProfile(user, { displayName: name })
                .then(() => {
                    set(ref(db, 'users/' + user.uid), {
                        name: name,
                        email: email,
                        is_local: isLocal,
                        pickup_plan: isLocal ? "Local" : pickupPlan,
                        is_approved: isLocal ? true : false,
                        joined_at: Date.now()
                    }).then(() => { window.location.href = "auction.html"; });
                });
            })
            .catch((error) => { showError(error.message); btn.disabled = false; btn.innerText = "Create Account"; });
        }

        function showError(msg) {
            const errDiv = document.getElementById('errorMsg');
            errDiv.style.display = 'block';
            let cleanMsg = msg.replace("Firebase: ", "").replace("auth/", "").replace(/-/g, " ");
            cleanMsg = cleanMsg.charAt(0).toUpperCase() + cleanMsg.slice(1);
            errDiv.innerText = cleanMsg;
        }

        // --- MODAL UI LOGIC ---
        window.openRulesModal = function() {
            document.getElementById('rulesModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        window.closeRulesModal = function(event) {
            if (!event || event.target === document.getElementById('rulesModal') || event.target.classList.contains('close-modal-btn')) {
                document.getElementById('rulesModal').style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
    </script>
</body>
</html>