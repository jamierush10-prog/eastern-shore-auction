<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome | The Auction House</title>
    <style>
        :root { --primary-color: #2563eb; --header-bg: #111827; --header-text: #f9fafb; --bg-color: #f3f4f6; --text-color: #1f2937; --live-color: #dc2626; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        header { width: 100%; background-color: var(--header-bg); color: var(--header-text); padding: 40px 20px; text-align: center; }
        .brand-name { font-family: "Georgia", "Times New Roman", serif; font-size: 2.5rem; letter-spacing: 2px; font-weight: bold; text-transform: uppercase; margin-bottom: 10px; }
        .tagline { font-size: 1.1rem; color: #9ca3af; font-style: italic; }

        .container { max-width: 800px; width: 90%; margin: 40px auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1 { color: var(--primary-color); text-align: center; margin-top: 0; }
        
        .rules-box { background: #f9fafb; padding: 25px; border-radius: 8px; border-left: 5px solid var(--primary-color); margin: 30px 0; }
        .rules-box p { line-height: 1.6; margin-bottom: 15px; font-size: 1.05rem; }
        .rules-box strong { color: #111827; }

        .action-area { text-align: center; margin-top: 40px; }
        .btn-list { display: inline-block; background-color: var(--primary-color); color: white; padding: 15px 40px; border-radius: 30px; font-size: 1.2rem; font-weight: bold; text-decoration: none; transition: transform 0.2s; cursor: pointer; border: none; }
        .btn-list:hover { transform: scale(1.05); background-color: #1d4ed8; }

        /* AUTH MODAL */
        #authModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 380px; box-shadow: 0 20px 25px rgba(0,0,0,0.2); position: relative; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb; }
        .tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; font-weight: bold; color: #6b7280; transition: color 0.2s; }
        .tab.active { color: var(--primary-color); border-bottom: 2px solid var(--primary-color); }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        .action-btn { width: 100%; padding: 12px; background: var(--header-bg); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .close-reg { text-align: center; margin-top: 15px; cursor: pointer; color: #6b7280; font-size: 0.9rem; text-decoration: underline; display: block; }
        .radio-group { display: flex; gap: 15px; margin-bottom: 15px; }
        .radio-label { font-weight: normal; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        #nonLocalWarning { display: none; background: #fff7ed; border: 1px solid #fed7aa; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 0.85rem; color: #9a3412; text-align: left; }

        /* ADMIN ONLY SECTION */
        #adminControls { display: none; margin-top: 50px; padding-top: 30px; border-top: 2px dashed #ccc; text-align: center; }
        .admin-title { font-weight: bold; color: var(--live-color); text-transform: uppercase; margin-bottom: 15px; display: block; }
        .btn-admin { background: #374151; color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px; font-weight: bold; margin: 0 5px; }

        @media (max-width: 600px) { .container { padding: 20px; } }
    </style>
</head>
<body>

    <header>
        <div class="brand-name">The Auction House</div>
        <div class="tagline">Baldwin County, Alabama</div>
    </header>

    <div class="container">
        <h1>Welcome to the Community!</h1>
        <p style="text-align: center; font-size: 1.1rem; color: #4b5563;">
            We are currently gathering items for our Grand Opening Auction. <br>
            Please review how our platform works below.
        </p>

        <div class="rules-box">
            <p><strong>‚è∞ Live Format</strong><br>
            The auction opens at a set time. Only one auction lot is up for bid at a time ("on the block").</p>
            
            <p><strong>‚è≥ 3-Minute Timer</strong><br>
            Each item is on the block for 3 minutes. Bids placed with less than 30 seconds remaining will reset the timer to 30 seconds.</p>
            
            <p><strong>ü§ù Contracts & Liability</strong><br>
            Winning bids form a contract between the Seller and the Buyer. The Auction House is a platform service only to connect buyers and sellers. We are not responsible for the quality of items sold or payment processing.</p>
            
            <p><strong>üìç Baldwin County Only</strong><br>
            This site is for buyers and sellers located in Baldwin County, Alabama. All auctions are designed for local pickup or delivery without shipping costs.</p>
        </div>

        <div class="action-area">
            <h3 style="margin-bottom: 15px;">Have something to sell?</h3>
            <button onclick="handleListButton()" class="btn-list" id="listBtn">+ List an Item Now</button>
        </div>

        <div id="adminControls">
            <span class="admin-title">‚ö†Ô∏è Admin Testing Access</span>
            <a href="admin.html" class="btn-admin">Dashboard</a>
            <a href="auction.html" class="btn-admin">Live Room</a>
        </div>
    </div>

    <div id="authModal">
        <div class="modal-content">
            <div class="tabs"><div class="tab active" onclick="switchTab('login')">Log In</div><div class="tab" onclick="switchTab('register')">Sign Up</div></div>
            <div id="errorMsg" class="error-msg" style="color:red; display:none; margin-bottom:10px;"></div>
            
            <form id="loginForm" onsubmit="event.preventDefault(); performLogin();">
                <div class="form-group"><input type="email" id="loginEmail" placeholder="Email Address" required></div>
                <div class="form-group"><input type="password" id="loginPass" placeholder="Password" required></div>
                <button type="submit" class="action-btn">Log In</button>
            </form>
            
            <form id="registerForm" style="display:none;" onsubmit="event.preventDefault(); performRegister();">
                <div class="form-group"><input type="text" id="regName" placeholder="Username" required></div>
                <div class="form-group"><input type="email" id="regEmail" placeholder="Email Address" required></div>
                <div class="form-group"><input type="password" id="regPass" placeholder="Password (6+ chars)" required></div>
                <div class="form-group">
                    <label>Located in Baldwin County, AL?</label>
                    <div class="radio-group">
                        <label class="radio-label"><input type="radio" name="isLocal" value="yes" checked onchange="toggleLocalFields(true)"> Yes</label>
                        <label class="radio-label"><input type="radio" name="isLocal" value="no" onchange="toggleLocalFields(false)"> No</label>
                    </div>
                </div>
                <div id="nonLocalWarning">
                    <strong>Note:</strong> Non-local accounts require Admin approval.
                    <div class="form-group" style="margin-top:10px;"><input type="text" id="pickupPlan" placeholder="Can you arrange local pickup?"></div>
                </div>
                <button type="submit" class="action-btn">Create Account</button>
            </form>
            <span class="close-reg" onclick="document.getElementById('authModal').style.display='none'">Cancel</span>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, get, child, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- PASTE YOUR FIREBASE KEYS HERE ---
        const firebaseConfig = {
  apiKey: "AIzaSyCt0i8a7ZVRlNmSts9yM4uGwV7ghPU59rk",
  authDomain: "eastern-shore-auction.firebaseapp.com",
  databaseURL: "https://eastern-shore-auction-default-rtdb.firebaseio.com",
  projectId: "eastern-shore-auction",
  storageBucket: "eastern-shore-auction.firebasestorage.app",
  messagingSenderId: "771348898846",
  appId: "1:771348898846:web:3b6371e8f826747fdcba0f"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        let isLoggedIn = false;

        // CHECK LOGIN STATE
        onAuthStateChanged(auth, (user) => {
            if (user) {
                isLoggedIn = true;
                // If admin, show tools
                get(child(ref(db), `admins/${user.uid}`)).then((snapshot) => {
                    if (snapshot.exists() && snapshot.val() === true) {
                        document.getElementById('adminControls').style.display = 'block';
                    }
                });
            } else {
                isLoggedIn = false;
            }
        });

        // --- BUTTON LOGIC ---
        window.handleListButton = function() {
            if (isLoggedIn) {
                // If logged in, go to Account Page
                window.location.href = "account.html";
            } else {
                // If not logged in, show Modal
                document.getElementById('authModal').style.display = 'flex';
            }
        }

        // --- AUTH FUNCTIONS ---
        window.performLogin = function() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            signInWithEmailAndPassword(auth, email, pass)
            .then(() => { window.location.href = "account.html"; }) // Go to account after login
            .catch((error) => { alert(error.message); });
        }

        window.performRegister = function() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            const isLocal = document.querySelector('input[name="isLocal"]:checked').value === "yes";
            const pickupPlan = document.getElementById('pickupPlan').value;

            createUserWithEmailAndPassword(auth, email, pass)
            .then((userCredential) => {
                const user = userCredential.user;
                updateProfile(user, { displayName: name })
                .then(() => {
                    set(ref(db, 'users/' + user.uid), {
                        name: name, email: email, is_local: isLocal, pickup_plan: isLocal ? "Local" : pickupPlan,
                        is_approved: isLocal ? true : false, joined_at: Date.now()
                    }).then(() => { 
                        window.location.href = "account.html"; // Go to account after signup
                    });
                });
            })
            .catch((error) => { alert(error.message); });
        }

        // --- UI HELPERS ---
        window.switchTab = function(mode) {
            if(mode === 'login') {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.querySelectorAll('.tab')[1].classList.remove('active');
            } else {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'block';
                document.querySelectorAll('.tab')[0].classList.remove('active');
                document.querySelectorAll('.tab')[1].classList.add('active');
            }
        }
        window.toggleLocalFields = function(isLocal) {
            const div = document.getElementById('nonLocalWarning');
            const input = document.getElementById('pickupPlan');
            if(isLocal) { div.style.display = 'none'; input.removeAttribute('required'); } 
            else { div.style.display = 'block'; input.setAttribute('required', 'true'); }
        }
    </script>
</body>
</html>